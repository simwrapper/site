import{r as E,g as I,k as G,R as C,M as ot,d as ht,C as Z,n as ct}from"./index-24c2379b.js";import{d as pt}from"./index-2d3640f5.js";import{y as ut}from"./index-719eff74.js";import{n as M}from"./naturalSort-c3659ff7.js";import{c as dt}from"./index-48a773a4.js";import{H as mt}from"./HTTPFileSystem-017e7593.js";import{P as gt,C as ft}from"./LegendColors-103b9dc7.js";import{Z as Ct}from"./ZoomButtons-85071e8e.js";import{p as K,f as vt,g as bt}from"./util-8430d78c.js";import{W as St}from"./RoadNetworkLoader.worker-ba4f3b4d.js";import{D as Tt,S as kt}from"./set-rtl-text-plugin-40f27fec.js";import{T as O,S as D}from"./text-layer-98e63af8.js";import{P as Y}from"./path-layer-7a20967b.js";import{A as R}from"./arc-layer-85831471.js";import{t as yt}from"./pureFunctionsAny.generated-9e006ffe.js";import"./layer-7bd8a07e.js";import"./layer-extension-7e1876a6.js";import"./fxp-b80b6d05.js";const x={pickup:[0,150,255],delivery:[240,0,60],service:[255,64,255]};var V=0;function $t(e){const[t,i]=E.useState(I.state.viewState),[s,n]=E.useState({}),[r,o]=E.useState({type:"activity",pickups:[],deliveries:[]});var{dark:a,activeTab:h,numSelectedTours:p,lspShipmentChains:g,shipments:u,depots:k,legs:y,settings:H,stopActivities:W,center:Q,onClick:B,projection:U}=e;const{simplifyTours:F,scaleFactor:$,shipmentDotsOnTourMap:N,showEachCarrierTour:A}=H;let L=$==0?1e-6:1/Math.pow(2,(100-$)/5-6);var[w,j]=E.useState([]);const tt=E.useRef(g);G[e.viewId]=()=>{i(I.state.viewState)},E.useEffect(()=>{const d={},c={};u.forEach(S=>{let l=`${S.fromX}-${S.fromY}`;d[l]||(d[l]={type:"pickup",shipmentIds:[],coord:[S.fromX,S.fromY]}),d[l].shipmentIds.push(S.$id),l=`${S.toX}-${S.toY}`,c[l]||(c[l]={type:"delivery",shipmentIds:[],coord:[S.toX,S.toY]}),c[l].shipmentIds.push(S.$id)}),o({type:"activity",pickups:Object.values(d),deliveries:Object.values(c)})},[u]);function et(d){d.object?B(d.object):B(null)}function st(d){i(d),d.center=[d.longitude,d.latitude],I.commit("setMapCamera",d)}function it(d){const{object:c}=d;return c?(c==null?void 0:c.type)=="pickup"?q(d,"pickup"):(c==null?void 0:c.type)=="delivery"?q(d,"delivery"):(c==null?void 0:c.type)=="leg"?rt(d):c!=null&&c.color?nt(d):(c==null?void 0:c.label)=="Depot"?void 0:lt(d):null}function q(d,c){const{object:S,x:l,y:v}=d;return C.createElement("div",{className:"tooltip",style:{backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",opacity:.9,left:l+20,top:v+20}},C.createElement("table",{style:{maxWidth:"30rem",fontSize:"0.8rem"}},C.createElement("tbody",null,C.createElement("tr",null,C.createElement("td",{style:{textAlign:"right",paddingRight:"0.5rem",paddingTop:"0.2rem"}},c,":"),C.createElement("td",{style:{paddingTop:"0.2rem"}},S.shipmentIds.join(", "))))))}function nt(d){const{object:c,x:S,y:l}=d;return d.layer.id=="HubChain"?C.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:S+20,top:l-30}},"Total Shipment Count: ",V," ",C.createElement("br",null),"Chain Type: ",c==null?void 0:c.chainId," ",C.createElement("br",null)):C.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:S+20,top:l-30}},"Shipment Id: ",c.shipmentId," ",C.createElement("br",null))}function rt(d){const{object:c,x:S,y:l}=d;return C.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:S+20,top:l-30}},"Vehicle Id: ",c==null?void 0:c.tour.vehicleId," ",C.createElement("br",null),"Tour Id: ",c==null?void 0:c.tour.tourId," ",C.createElement("br",null))}function Ht(d){}function lt(d){const{object:c,x:S,y:l}=d,v=c.visits.length,T=c.visits.reduce((P,z)=>P+z.pickup.length,0),m=c.visits.reduce((P,z)=>P+z.delivery.length,0),b=c.visits.reduce((P,z)=>P+z.service.length,0),f=T+m,_={visits:v,pickups:T,deliveries:m,services:b},J=Object.keys(c).length*20+32;let X=l-30;return X+J>window.innerHeight&&(X=l-J),C.createElement("div",{className:"tooltip",style:{fontSize:"0.7rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:S+20,top:X}},C.createElement("table",{style:{fontSize:"0.8rem"}},C.createElement("tbody",null,Object.keys(_).map(P=>C.createElement("tr",{key:P},C.createElement("td",{style:{textAlign:"right",paddingRight:"0.5rem"}},P,":"),C.createElement("td",{style:{fontWeight:"bold"}}," ",_[P]))),f==1&&Object.keys(c.details).map(P=>C.createElement("tr",{key:P},C.createElement("td",{style:{textAlign:"right",paddingRight:"0.5rem",paddingTop:"0.2rem"}},P.slice(1),":"),C.createElement("td",{style:{paddingTop:"0.2rem"}},c.details[P]))))))}if(console.log(e.carrierServices),h=="lspTours"){let d=function(l){let v=0;for(let f=0;f<l.length;f++)v=l.charCodeAt(f)+((v<<5)-v);const T=(v&16711680)>>16,m=(v&65280)>>8,b=v&255;return[T,m,b]},c=function(l){let v=0;for(let f=0;f<l.tour.tourId.length;f++)v=l.tour.tourId.charCodeAt(f)+((v<<5)-v);v*=l.tour.tourNumber;const T=(v%360+360)%360;return S(T,70,50)},S=function(l,v,T){v/=100,T/=100;const m=_=>(_+l/30)%12,b=v*Math.min(T,1-T),f=_=>T-b*Math.max(-1,Math.min(m(_)-3,Math.min(9-m(_),1)));return[Math.round(f(0)*255),Math.round(f(8)*255),Math.round(f(4)*255)]};w=[],u.length>1,e.showHub===!0&&e.hubLocation.length>0?w.push(new O({id:"pickupsHubChain",data:e.hubLocation,getPosition:[e.hubLocation[0],e.hubLocation[1]],getText:()=>e.hubName,getRadius:2,opacity:.9,background:!0,backgroundPadding:p!==1?[2,1,2,1]:[3,2,3,1],getBackgroundColor:()=>[240,130,0],getColor:[255,255,255],parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels",getSize:l=>11,getTextAnchor:"middle",getAlignmentBaseline:"center",noAlloc:!1,billboard:!0,sizeScale:1,autoHighlight:!0,onHover:n})):(w.push(new Y({id:"shipmentLocationDashedLine",data:W,getPath:l=>[l.ptFrom,l.ptTo],getColor:[128,128,128],getOffset:2,opacity:1,widthMinPixels:3,rounded:!0,shadowEnabled:!1,pickable:!1,autoHighlight:!1,highlightColor:[255,255,255],parameters:{depthTest:!1},getDashArray:[3,2],dashJustified:!0,extensions:[new gt({dash:!0})]})),!A&&F?w.push(new R({id:"leg-arcs",data:y,getSourcePosition:l=>l.points[0],getTargetPosition:l=>l.points[l.points.length-1],getSourceColor:l=>d(l.tour.vehicleId),getTargetColor:l=>d(l.tour.vehicleId),getWidth:$?l=>l.totalSize/2:3,getHeight:.5,widthMinPixels:2,widthMaxPixels:200,widthUnits:"pixels",widthScale:L,opacity:.9,parameters:{depthTest:!1},updateTriggers:{getWidth:[$]},transitions:{getWidth:150},pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],onHover:n})):A&&!F?w.push(new Y({id:"deliveryroutes2",data:y,getPath:l=>l.points,getColor:l=>c(l),getWidth:$?l=>l.totalSize:3,getOffset:2,opacity:1,widthMinPixels:3,widthMaxPixels:200,widthUnits:"pixels",widthScale:L,rounded:!0,shadowEnabled:!1,pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],onHover:n,parameters:{depthTest:!1},updateTriggers:{getWidth:[$]},transitions:{getWidth:150}})):F&&A?w.push(new R({id:"leg-arcs",data:y,getSourcePosition:l=>l.points[0],getTargetPosition:l=>l.points[l.points.length-1],getSourceColor:l=>c(l),getTargetColor:l=>c(l),getWidth:$?l=>l.totalSize/2:3,getHeight:.5,widthMinPixels:2,widthMaxPixels:200,widthUnits:"pixels",widthScale:L,opacity:.9,parameters:{depthTest:!1},updateTriggers:{getWidth:[$]},transitions:{getWidth:150},pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],onHover:n})):w.push(new Y({id:"deliveryroutes1",data:y,getPath:l=>l.points,getColor:l=>d(l.tour.vehicleId),getWidth:$?l=>l.totalSize:3,getOffset:2,opacity:1,widthMinPixels:3,widthMaxPixels:200,widthUnits:"pixels",widthScale:L,rounded:!0,shadowEnabled:!1,pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],onHover:n,parameters:{depthTest:!1},updateTriggers:{getWidth:[$]},transitions:{getWidth:150}})),w.push(new O({id:"dest-labels",data:W,background:!0,backgroundPadding:p!==1?[2,1,2,1]:[3,2,3,1],getColor:[255,255,255],getBackgroundColor:l=>{const v=l.visits.reduce((b,f)=>b+f.pickup.length,0),T=l.visits.reduce((b,f)=>b+f.delivery.length,0),m=l.visits.reduce((b,f)=>b+f.service.length,0);return v&&T?[0,0,255]:v?x.pickup:T||m?x.delivery:[240,130,0]},getPosition:l=>l.midpoint,getText:l=>l.label=="Hub"?l.label:p!==1?" ":`${l.label}`,getSize:l=>l.label=="Hub"?11:p!==1?4:11,getTextAnchor:"middle",getAlignmentBaseline:"center",opacity:1,noAlloc:!1,billboard:!0,sizeScale:1,pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],onHover:n,visible:N})))}if(h=="shipments")if(e.showHub&&e.hubLocation.length>0)w.push(new O({id:"shipmentHubs",data:e.hubLocation,getPosition:[e.hubLocation[0],e.hubLocation[1]],getText:()=>e.hubName,getRadius:2,opacity:.9,background:!0,backgroundPadding:p!==1?[2,1,2,1]:[3,2,3,1],getBackgroundColor:()=>[240,130,0],getColor:[255,255,255],parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels",getSize:d=>11,getTextAnchor:"middle",getAlignmentBaseline:"center",noAlloc:!1,billboard:!0,sizeScale:1,autoHighlight:!0,onHover:n}));else{w.push(new D({id:"deliveries",data:r.deliveries,getPosition:c=>c.coord,getColor:x.delivery,getRadius:3,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels",onHover:n})),w.push(new D({id:"pickups",data:r.pickups,getPosition:c=>c.coord,getColor:x.pickup,getRadius:2,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels",onHover:n}));const d=u.length>1?32:255;w.push(new R({id:"shipments",data:u,getSourcePosition:c=>[c.fromX,c.fromY],getTargetPosition:c=>[c.toX,c.toY],getSourceColor:[0,228,255,d],getTargetColor:[240,0,60,224],getWidth:parseInt("100")||1*.5,widthUnits:"pixels",getHeight:.5,opacity:.9,parameters:{depthTest:!1},widthScale:L,widthMinPixels:1,widthMaxPixels:100,updateTriggers:{getWidth:[$]},transitions:{getWidth:200}}))}if(h==="lspShipmentChains"&&e.showHub&&e.hubLocation.length>0){let d=g;g=[],g=d,w.push(new O({id:"lspHubs2",data:e.hubLocation,getPosition:[e.hubLocation[0],e.hubLocation[1]],getText:()=>e.hubName,getRadius:2,opacity:.9,background:!0,backgroundPadding:p!==1?[2,1,2,1]:[3,2,3,1],getBackgroundColor:()=>[240,130,0],getColor:[255,255,255],parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels",getSize:c=>11,getTextAnchor:"middle",getAlignmentBaseline:"center",noAlloc:!1,billboard:!0,sizeScale:1,autoHighlight:!0,onHover:n}))}E.useEffect(()=>{const d=[],c=u.length>1?32:255;function S(T,m){return T+1==Number(m.route.length-1)?.1:2}function l(T,m){return T+1==Number(m.route.length-1)?[0,228,255,c]:[255,255,255]}function v(T,m){return T+1==Number(m.route.length-1)?[240,0,60,224]:[255,255,255]}if(h==="lspShipmentChains"&&!e.showHub&&e.hubLocation.length==0){const T=u.length>1?32:255;g[0].hubsChains.length===0?(d.push(new R({id:"shipmentdirectchains",data:g[0].directChains,getSourcePosition:m=>[m.fromX,m.fromY],getTargetPosition:m=>[m.toX,m.toY],getSourceColor:[0,228,255,T],getTargetColor:[240,0,60,224],getWidth:1,widthUnits:"pixels",getHeight:.5,opacity:.9,parameters:{depthTest:!1},widthScale:L,widthMinPixels:1,widthMaxPixels:100,updateTriggers:{getWidth:[$]},transitions:{getWidth:200}})),d.push(new D({id:"deliveriesHubChain",data:g[0].directChains,getPosition:m=>[m.toX,m.toY],getColor:x.delivery,getRadius:3,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels",onHover:n})),d.push(new D({id:"pickupsHubChain",data:g[0].directChains,getPosition:m=>[m.fromX,m.fromY],getColor:x.pickup,getRadius:2,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels"}))):(V=0,g[0].hubsChains.forEach(m=>{V++;for(let b=0;b<m.route.length-1;b++)d.push(new R({id:"shipmenthubchains",data:g[0].hubsChains,getSourcePosition:f=>[f.route[b][0],f.route[b][1]],getTargetPosition:f=>[f.route[b+1][0],f.route[b+1][1]],getSourceColor:l(b,m),getTargetColor:v(b,m),getWidth:S(b,m),widthUnits:"pixels",getHeight:.5,opacity:.9,parameters:{depthTest:!1},widthScale:L,widthMinPixels:1,widthMaxPixels:100,updateTriggers:{getWidth:[$]},transitions:{getWidth:200}})),d.push(new D({id:"HubChain",data:g[0].hubsChains,getPosition:f=>[f.route[b][0],f.route[b][1]],getColor:x.pickup,getRadius:3,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels"}))}),d.push(new O({id:"HubChain",data:g[0].hubsChains,getPosition:m=>[m.hubs[0].locationX,m.hubs[0].locationY],getText:m=>m.hubs[0].id,getAlignmentBaseline:"center",getColor:[255,255,255],getBackgroundColor:[240,130,0],background:!0,backgroundPadding:[2,2,2,2],fontWeight:"normal",getSize:10,getTextAnchor:"middle",pickable:!0,onHover:n})),d.push(new D({id:"deliveriesHubChain",data:g[0].hubsChains,getPosition:m=>[m.toX,m.toY],getColor:x.delivery,getRadius:3,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels",onHover:n})),d.push(new D({id:"pickupsHubChain",data:g[0].hubsChains,getPosition:m=>[m.fromX,m.fromY],getColor:x.pickup,getRadius:2,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels"})))}j(d),tt.current=g},[g]);const at=U&&U!=="Atlantis";return C.createElement(Tt,{layers:w,pickingRadius:3,controller:!0,getCursor:()=>"pointer",onClick:et,viewState:t,onViewStateChange:d=>st(d.viewState)},at&&C.createElement(kt,{mapboxApiAccessToken:ot,mapStyle:I.getters.mapStyle}),it(s))}const wt={messages:{en:{carriers:"Carriers",vehicles:"VEHICLES",services:"SERVICES",shipments:"SHIPMENTS",tours:"TOURS",pickup:"Pickup",service:"service",delivery:"Delivery",flatten:"Simple&nbsp;tours",shipmentDots:"Show shipments",scaleSize:"Widths",scaleFactor:"Width","Shipment Chains":"Shipment Chains",Shipments:"Shipments","LSP Tours":"LSP Tours",lspShipmentChains:"lspShipmentChains","Carrier Tours":"Carrier Tours",Tours:"Tours"},de:{carriers:"Unternehmen",vehicles:"FAHRZEUGE",services:"BETRIEBE",shipments:"LIEFERUNGEN",service:"service",tours:"TOUREN",pickup:"Abholung",delivery:"Lieferung","shipment Chains":"Lieferungketten",Tours:"Tours"}}};M.insensitive=!0;const Lt=ht({name:"LogisticsPlugin",i18n:wt,components:{LegendColors:ft,ToggleButton:pt.ToggleButton,TourViz:$t,ZoomButtons:Ct},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean},data:()=>({linkLayerId:Math.floor(1e12*Math.random()),vizSettings:{simplifyTours:!1,showEachCarrierTour:!1,scaleShipmentSizes:!0,shipmentDotsOnTourMap:!0,scaleFactor:0},vizDetails:{network:"",carriers:"",lsps:"",projection:"",title:"",description:"",thumbnail:"",center:null},myState:{statusMessage:"",isRunning:!1,subfolder:"",yamlConfig:"",thumbnail:!0,data:[]},searchTerm:"",searchEnabled:!1,globalState:I.state,isLoaded:!0,showHelp:!1,activeTab:"",speedStops:[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],speed:1,legendBits:[],links:null,toggleTours:!0,toggleVehicles:!0,toggleShipments:!0,toggleServices:!0,detailContent:"",linksCsvData:null,data:null,darkMode:null,lightMode:null,lsps:[],lspPlan:{},resources:[],lspShipmentChains:[],lspShipmentDirectChains:[],lspShipmentHubChains:[],lspChainTours:[],lspChainToursAll:[],lspToursAll:[],lspCarriers:[],lspHubChainCarriers:[],lspHubCarriers:[],lspDirectCarriers:[],lspCarrier:{},allHubChains:[],allCarrierHubIds:[],hubLocation:[],showHub:!1,hubName:"",carriers:[],carrierTours:[],carrierServicesAll:new Set,showCompleteHubChain:!1,showCarrierTours:!1,showCarrierToursList:!1,vehicles:[],shipments:[],shipmentLookup:{},services:[],stopActivities:[],tours:[],plans:[],shownShipments:[],shipmentIdsInTour:[],depots:[],shownDepots:[],shownLegs:[],selectedLsp:"",selectedCarrier:"",selectedTours:[],selectedPlan:null,selectedPlanIndex:null,selectedShipment:null,selectedLSPChain:null,thumbnailUrl:"",vehicleLookup:[],vehicleLookupString:{},rgb:dt({colormap:"phase",nshades:9,format:"rba"}).map(e=>e.slice(0,3)).reverse(),dropdownIsActive:!1}),computed:{fileApi(){return new mt(this.fileSystem,I)},fileSystem(){const e=this.$store.state.svnProjects.filter(t=>t.slug===this.root);if(e.length===0)throw console.log("no such project"),Error;return e[0]},textColor(){const e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.globalState.isDarkMode?t:e}},watch:{"$store.state.viewState"(){G[this.linkLayerId]&&G[this.linkLayerId]()},"globalState.isDarkMode"(){this.updateLegendColors()},async"globalState.authAttempts"(){console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),await this.getVizDetails()},"this.activeTab"(){console.log(this.activeTab)}},methods:{checkIfHubChain(){return this.lspShipmentHubChains.length>0},checkIfDirectChain(){return this.lspShipmentDirectChains.length>0&&this.lspShipmentHubChains.length==0},handleSelectShipment(e){if(this.selectedShipment===e){if(this.selectedShipment=null,this.shownShipments=[],!this.selectedTours.length){const t=this.carriers.filter(i=>i.$id==this.selectedCarrier);this.selectedCarrier="",this.handleSelectCarrier(t[0])}return}this.shownShipments=this.shipments.filter(t=>t.$id===e.$id),this.selectedShipment=e},handleSelectShipmentChain(e){if(this.selectedLSPChain===e){if(this.selectedLSPChain=null,this.shownShipments=[],this.selectedLSPChain==null){const i=this.lsps.filter(n=>n.$id==this.selectedLsp);let s;i[0].resources.carrier.forEach(n=>{n.$id==this.selectedCarrier&&(s=n)}),this.shipments=this.processShipments(s),this.lspShipmentChains=[],this.lspShipmentChains.push(this.processLogisticChains(this.shipments)),this.shownShipments=this.shipments}return}let t={hubsChains:this.lspShipmentHubChains,directChains:this.lspShipmentDirectChains};t.hubsChains=this.lspShipmentHubChains.filter(i=>i.shipmentId===e.shipmentId),t.directChains=[],this.lspShipmentChains=[],this.lspShipmentChains.push(t),this.selectedLSPChain=e},processActivitiesInTour(e){const t=[];let i=0;const s={};let n=[],r="";if(this.lspShipmentHubChains.length>0){const a=this.links[this.lspShipmentHubChains[0].hubs[this.lspShipmentHubChains[0].hubs.length-1].location];n=[.5*(a[0]+a[2]),.5*(a[1]+a[3])],r=this.lspShipmentHubChains[0].hubs[this.lspShipmentHubChains[0].hubs.length-1].location,s[`L${this.lspShipmentHubChains[0].hubs[this.lspShipmentHubChains[0].hubs.length-1].location}`]={link:this.lspShipmentHubChains[0].hubs[this.lspShipmentHubChains[0].hubs.length-1].location,midpoint:n,visits:[{pickup:[],delivery:[],service:[]}],label:"",tour:e,details:{},ptFrom:[a[0],a[1]],ptTo:[a[2],a[3]]}}else if(this.lspShipmentDirectChains.length>0){const a=this.links[this.lspShipmentDirectChains[0].from];n=[.5*(a[0]+a[2]),.5*(a[1]+a[3])],r=this.lspShipmentDirectChains[0].from,s[`L${this.lspShipmentDirectChains[0].from}`]={link:this.lspShipmentDirectChains[0].from,midpoint:n,visits:[{pickup:[],delivery:[],service:[]}],label:"",tour:e,details:{},ptFrom:[a[0],a[1]],ptTo:[a[2],a[3]]}}else{const a=this.links[this.lspShipmentChains[0].from];n=[.5*(a[0]+a[2]),.5*(a[1]+a[3])],r=this.lspShipmentChains[0].from,s[`L${this.lspShipmentChains[0].from}`]={link:this.lspShipmentChains[0].from,midpoint:n,visits:[{pickup:[],delivery:[],service:[]}],label:"",tour:e,details:{},ptFrom:[a[0],a[1]],ptTo:[a[2],a[3]]}}e.plan.forEach(a=>{if(a.$serviceId)if(t.push(a.$serviceId),e.vehicleId=="mainTruck"){const h=e.legs[0].links[0],p=[this.links[h][0],this.links[h][1]],g=[this.links[h][2],this.links[h][3]],u=[.5*(p[0]+g[0]),.5*(p[1]+g[1])],k=this.$t(String(a.$type)),y={id:e.id,type:k,count:i++,link:h,midpoint:u,label:"",tour:e,ptFrom:p,ptTo:g};if(h==r)s[`L${h}`].visits[s[`L${h}`].visits.length-1][a.$type].push(y);else if(`L${h}`in s){const H={pickup:[],delivery:[],service:[]};H[a.$type].push(y),s[`L${h}`].visits.push(H)}else{const H={pickup:[],delivery:[],service:[]};H[a.$type].push(y),s[`L${h}`]={link:h,midpoint:u,label:"",tour:e,ptFrom:p,ptTo:g,visits:[H]}}r=h}else{const h=this.shipmentLookup[a.$serviceId];if(!h)return;const p=a.$type==="pickup"?h.$from:h.$to,g=[this.links[p][0],this.links[p][1]],u=[this.links[p][2],this.links[p][3]],k=[.5*(g[0]+u[0]),.5*(g[1]+u[1])],y=this.$t(a.$type),{from:H,fromX:W,fromY:Q,to:B,toX:U,toY:F,id:$,...N}=h,A={id:h.$id,type:y,count:i++,link:p,midpoint:k,label:"",tour:e,details:N,ptFrom:g,ptTo:u};if(p==r)s[`L${p}`].visits[s[`L${p}`].visits.length-1][a.$type].push(A);else if(`L${p}`in s){const L={pickup:[],delivery:[],service:[]};L[a.$type].push(A),s[`L${p}`].visits.push(L)}else{const L={pickup:[],delivery:[],service:[]};L[a.$type].push(A),s[`L${p}`]={link:p,midpoint:k,label:"",tour:e,details:N,ptFrom:g,ptTo:u,visits:[L]}}r=p}});const o=Object.values(s);for(let a=0;a<o.length;a++)o[a].label=`${a}`;return this.lspShipmentHubChains.length>0?o[0].label="Hub":o[0].label="Depot",{shipmentIdsInTour:t,stopActivities:o}},setupDepots(){const e={};this.vehicles.forEach(t=>{const i=t.$depotLinkId;let s=this.links[i];s&&(e[i]||(e[i]={type:"depot",link:t.$depotLinkId,midpoint:[.5*(s[0]+s[2]),.5*(s[1]+s[3])],coords:this.links[t.$depotLinkId],vehicles:{}}),e[i].vehicles[t.$id]=t)}),this.depots=Object.values(e),this.shownDepots=this.depots.slice(0)},selectAllLspTours(){this.selectedTours=[],this.shownLegs=[],this.stopActivities=[],this.shownDepots=[],this.shownShipments=this.shipments.slice(0);for(const e of this.lspChainToursAll)for(const t of e){t.legs.forEach((s,n)=>this.addRouteToMap(t,s,n++));const i=this.processActivitiesInTour(t);this.stopActivities=this.stopActivities.concat(i.stopActivities),this.setupDepots()}},selectAllTours(){if(this.selectedTours=[],this.shownLegs=[],this.stopActivities=[],this.shownDepots=[],this.shownShipments=this.shipments.slice(0),this.carrierTours.length>0)for(const e of this.carrierTours[0]){e.legs.forEach((i,s)=>this.addRouteToMap(e,i,s++));const t=this.processActivitiesInTour(e);this.stopActivities=this.stopActivities.concat(t.stopActivities),this.setupDepots()}else for(const e of this.lspChainToursAll){e.legs.forEach((i,s)=>this.addRouteToMap(e,i,s++));const t=this.processActivitiesInTour(e);this.stopActivities=this.stopActivities.concat(t.stopActivities),this.setupDepots()}},hslToRgb(e,t,i){t/=100,i/=100;const s=o=>(o+e/30)%12,n=t*Math.min(i,1-i),r=o=>i-n*Math.max(-1,Math.min(s(o)-3,Math.min(9-s(o),1)));return[Math.round(r(0)*255),Math.round(r(8)*255),Math.round(r(4)*255)]},getTourColor(e,t){let i=0;for(let a=0;a<e.length;a++)i=e.charCodeAt(a)+((i<<5)-i);i*=t;const s=(i%360+360)%360,n=70,r=50;let o=this.hslToRgb(s,n,r);return`rgb(${o[0]}, ${o[1]}, ${o[2]})`},getLspTourColor(e){let t=0;for(let r=0;r<e.length;r++)t=e.charCodeAt(r)+((t<<5)-t);const i=(t&16711680)>>16,s=(t&65280)>>8,n=t&255;return`rgb(${i}, ${s}, ${n})`},async handleSelectTour(e){if(!e.legs.length){console.log("No Route.");for(let n=0;n<e.plan.length;n++)if(e.plan[n].$shipmentId){const r=e.plan[n].$shipmentId,o=[this.shipmentLookup[r].$from,this.shipmentLookup[r].$to];e.legs.push({links:o})}this.vizSettings.simplifyTours=!0}if(this.selectedTours.includes(e)){this.selectedTours=this.selectedTours.filter(n=>n!==e),this.shownLegs=this.shownLegs.filter(n=>n.tour!==e),this.stopActivities=this.stopActivities.filter(n=>n.tour!==e),this.selectedTours.length||this.selectAllTours();return}this.selectedTours.length||(this.selectedTours=[],this.shownLegs=[],this.stopActivities=[],this.shownDepots=[]),this.selectedTours.push(e);const{shipmentIdsInTour:t,stopActivities:i}=this.processActivitiesInTour(e);this.shipmentIdsInTour=t;let s=0;for(const n of e.legs)this.addRouteToMap(e,n,s++);this.stopActivities=this.stopActivities.concat(i)},addRouteToMap(e,t,i){const s=[[this.links[t.links[0]][0],this.links[t.links[0]][1]]];for(const n of t.links){const r=s[s.length-1],o=[this.links[n][0],this.links[n][1]];(o[0]!==r[0]||o[1]!==r[1])&&s.push(o),s.push([this.links[n][2],this.links[n][3]])}this.shownLegs=this.shownLegs.concat([{tour:e,shipmentsOnBoard:t.shipmentsOnBoard,totalSize:t.totalSize,count:i,points:s,color:this.rgb[(3+s.length)%this.rgb.length],type:"leg"}])},handleSelectLspButton(e){this.showCarrierToursList=!1,this.activeTab="lspTours",this.selectedCarrier="",this.handleSelectLsp(e)},handleSelectLspFromList(e){this.showCarrierToursList=!1,this.lspShipmentDirectChains.length==0&&this.lspShipmentHubChains.length==0?this.activeTab="lspShipmentChains":this.activeTab="shipments",this.selectedCarrier=e.resources.carrier[0].$id,this.handleSelectLsp(e)},handleSelectLsp(e){typeof e=="string"&&(e=this.lsps.find(n=>n.$id===e)),this.lspToursAll=[],this.lspCarriers=[],this.lspHubChainCarriers=[],this.allHubChains=[],this.lspHubChainCarriers=this.findLspHubChainCarriers(e),this.lspCarriers=e.resources.carrier.filter(n=>!this.allCarrierHubIds.includes(n.$id));const t=e.$id;this.selectedLsp=t;let i=this.carriers.find(n=>n.$id===e.resources.carrier[0].$id);this.shipments=this.processShipments(i),this.lspShipmentChains=[],this.lspShipmentChains.push(this.processLogisticChains(this.shipments)),this.shownShipments=this.shipments;let s=e.LspPlans.LspPlan.find(n=>n.$selected==="true");this.lspChainToursAll=[],s.logisticChains.logisticChain.forEach(n=>{n.logisticChainElement.forEach(r=>{let o=this.processTours(r);o.length>0&&this.lspChainToursAll.push(o)})}),this.lspChainToursAll.forEach(n=>{this.lspToursAll=this.lspToursAll.concat(n)}),this.selectAllLspTours()},getCarrierServicesForHubChain(e){this.showCompleteHubChain=!0,this.handleSelectLsp(e)},findLspHubChainCarriers(e){let t={};e.LspPlans.LspPlan.forEach(n=>{n.$selected==="true"&&(t=n)});let i=[];t.logisticChains.logisticChain.forEach(n=>{n.$id=="hubChain"&&i.push(n)});let s=0;return i.forEach(n=>{let r={chainIds:[],chainIndex:s};n.logisticChainElement.forEach(o=>{r.chainIds.push(o.$resourceId),this.allCarrierHubIds.push(o.$resourceId)}),this.allHubChains.push(r),s++}),this.allHubChains},handleSelectCarrier(e){var p,g;let t={};if(yt(e)=="string"?t=this.carriers.find(u=>u.$id===e):t=this.carriers.find(u=>u.$id===e.$id),this.showHub=!1,this.hubLocation=[],t==null){this.shipments=[],this.hubLocation=[],this.lspShipmentChains=[];let k=this.lsps.find(y=>y.$id==this.selectedLsp).resources.hub.find(y=>y.$id==e);this.hubLocation.push(.5*(this.links[k.$location][0]+this.links[k.$location][2])),this.hubLocation.push(.5*(this.links[k.$location][1]+this.links[k.$location][3])),this.hubName=e,this.showHub=!0,this.selectedCarrier=e;return}if(this.dropdownIsActive=!1,!this.links)return;const i=t.$id;if(this.vehicles=[],this.shipments=[],this.services=[],this.plans=[],this.shownShipments=[],this.shownDepots=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopActivities=[],this.shownLegs=[],this.selectedCarrier===i){this.selectedCarrier="",console.log("carriers unselected - TRIGGER THE LSP!"),this.handleSelectLsp(this.lsps.find(u=>u.$id==this.selectedLsp));return}this.selectedCarrier=i,this.setupDepots(),this.shipments=this.processShipments(t),this.lspShipmentChains=[],this.lspShipmentChains.push(this.processLogisticChains(this.shipments)),(g=(p=t.services)==null?void 0:p.service)!=null&&g.length&&(this.services=t==null?void 0:t.services.service.map(u=>u.$).sort((u,k)=>M(u.$id,k.$id))),this.shownShipments=this.shipments,this.lspChainTours=[],this.lspChainToursAll=[];let s={};this.lsps.forEach(u=>{u.resources.carrier.find(k=>k.$id==t.$id)&&(s=u)});let n={};s.LspPlans.LspPlan.forEach(u=>{u.$selected==="true"&&(n=u)}),this.carrierTours=[];let r=n.logisticChains.logisticChain.find(u=>u.$id==="directChain"),o=n.logisticChains.logisticChain.find(u=>u.$id==="hubChain"),a=[],h=[];r&&r.logisticChainElement.forEach(u=>{a.push(u.$resourceId)}),o&&o.logisticChainElement.forEach(u=>{h.push(u.$resourceId)}),a.find(u=>u===t.$id)?r.logisticChainElement.forEach(u=>{u.$resourceId===t.$id&&this.carrierTours.push(this.processTours(u))}):h.find(u=>u===t.$id)&&o.logisticChainElement.forEach(u=>{u.$resourceId===t.$id&&this.carrierTours.push(this.processTours(u)),this.lspChainTours.push(this.processTours(u))}),this.lspChainTours.forEach(u=>{this.lspChainToursAll=this.lspChainToursAll.concat(u)}),this.lspChainToursAll.length==0?this.lspChainToursAll.push(this.carrierTours):this.lspChainToursAll.concat(this.carrierTours),this.activeTab!="lspTours"&&this.activeTab!="tours"&&!this.allCarrierHubIds.includes(e)&&(this.activeTab="shipments"),this.activeTab!="lspTours"&&this.activeTab!="tours"&&this.allCarrierHubIds.includes(e)&&(this.activeTab="lspShipmentChains"),this.selectAllTours()},getAllPlans(e){if(e.plan!=null){this.plans.push(e.plan),this.selectedPlan=e.plan;return}if(e.plans!=null){if(e.plans.plan.length==null){this.plans.push(e.plans.plan),this.selectedPlan=e.plans.plan;return}this.plans=e.plans.plan;for(let t=0;t<e.plans.plan.length;t++){if(e.plans.plan[t].selected=="true"){this.selectedPlan=e.plans.plan[t];break}this.selectedPlan=e.plans.plan[t]}}},processTours(e){let t=this.carriers.find(i=>i.$id===e.$resourceId);if(t!=null){this.getAllPlans(t),Array.isArray(this.selectedPlan.tour)||(this.selectedPlan.tour=[this.selectedPlan.tour]);const i=this.selectedPlan.tour.map((s,n)=>{const r=[s.act[0]],o=new Set;for(let p=1;p<s.act.length;p++)s.leg[p-1].shipmentsOnBoard=[...o],r.push(s.leg[p-1]),r.push(s.act[p]),s.act[p].$type=="pickup"&&s.act[p].$shipmentId&&o.add(s.act[p].$shipmentId),s.act[p].$type=="delivery"&&s.act[p].$shipmentId&&o.delete(s.act[p].$shipmentId);const a=s.leg.filter(p=>p.route&&p.route.length).map(p=>{const g=p.shipmentsOnBoard.map(k=>this.shipmentLookup[k]),u=g.reduce((k,y)=>k+parseFloat((y==null?void 0:y.$size)||0),0);return{shipmentsOnBoard:g,totalSize:u,links:p.route?p.route.split(" "):[]}});return{vehicleId:s.$vehicleId,tourId:s.$tourId,plan:r,legs:a,tourNumber:0}});return i.sort((s,n)=>M(s.vehicleId,n.vehicleId)),i.forEach((s,n)=>s.tourNumber=n),i}else return[]},processLogisticChains(e){this.lspShipmentHubChains=[],this.lspShipmentDirectChains=[];let t=this.lsps.find(s=>s.$id===this.selectedLsp);for(let s=0;s<t.LspPlans.LspPlan.length;s++)t.LspPlans.LspPlan[s].$selected=="true"&&(this.lspPlan=t.LspPlans.LspPlan[s]);console.log(this.lspPlan);try{for(let s=0;s<this.lspPlan.shipmentPlans.shipmentPlan.length;s++){let n=e.find(r=>r.$id==this.lspPlan.shipmentPlans.shipmentPlan[s].$shipmentId);if(n){let r={isDirectChain:!0,hubs:[],from:n.$from,to:n.$to,fromX:.5*(this.links[n.$from][0]+this.links[n.$from][2]),fromY:.5*(this.links[n.$from][1]+this.links[n.$from][3]),toX:.5*(this.links[n.$to][0]+this.links[n.$to][2]),toY:.5*(this.links[n.$to][1]+this.links[n.$to][3]),chainId:this.lspPlan.shipmentPlans.shipmentPlan[s].$chainId,route:[],color:0,shipmentId:n.$id};if(r.chainId==="directChain")this.lspShipmentDirectChains.push(r);else if(r.chainId==="hubChain"){r.isDirectChain=!1;for(let o=0;o<this.lspPlan.shipmentPlans.shipmentPlan[s].element.length;o++){let a=t.resources.hub.find(h=>h.$id==this.lspPlan.shipmentPlans.shipmentPlan[s].element[o].$resourceId);if(a){let h={id:this.lspPlan.shipmentPlans.shipmentPlan[s].element[o].$resourceId,location:a.$location,locationX:.5*(this.links[a.$location][0]+this.links[a.$location][2]),locationY:.5*(this.links[a.$location][1]+this.links[a.$location][3])};r.hubs.push(h)}}r.route.push([r.fromX,r.fromY]),r.hubs.forEach(o=>{r.route.push([o.locationX,o.locationY])}),r.route.push([r.toX,r.toY]),r.color=this.rgb[(3+r.route.length)%this.rgb.length],this.lspShipmentHubChains.push(r)}}}}catch{console.log("processing of logisitc chains failed")}return{hubsChains:this.lspShipmentHubChains,directChains:this.lspShipmentDirectChains}},processShipments(e){var o,a;this.shipmentLookup={};let t={};if(this.lsps.forEach(h=>{h.resources.carrier.find(p=>p.$id==e.$id)&&(t=h)}),!((a=(o=t.shipments)==null?void 0:o.shipment)!=null&&a.length))return[];this.carriers.forEach(h=>{h.$id==e.$id});const i=t.LspPlans.LspPlan.find(h=>h.$selected=="true"),s=[];i.shipmentPlans.shipmentPlan.forEach(h=>{h.element.forEach(p=>{p.$resourceId==e.$id&&s.push(h.$shipmentId)})});let n=[];[...new Set(s)].forEach(h=>{t.shipments.shipment.find(p=>{p.$id==h&&n.push(p)})}),n=n.sort((h,p)=>M(h.$id,p.$id));try{n.forEach(h=>{h.fromX=.5*(this.links[h.$from][0]+this.links[h.$from][2]),h.fromY=.5*(this.links[h.$from][1]+this.links[h.$from][3]),h.toX=.5*(this.links[h.$to][0]+this.links[h.$to][2]),h.toY=.5*(this.links[h.$to][1]+this.links[h.$to][3]),this.shipmentLookup[h.$id]=h})}catch{}return n},addToSet(e,t){Array.from(e).some(s=>JSON.stringify(s)===JSON.stringify(t))||e.add(t)},buildRouteFromUrl(){const e=this.$route.params;if(!e.project||!e.pathMatch){console.log("I CANT EVEN: NO PROJECT/PARHMATCH");return}const t=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,t),s=e.pathMatch.substring(t);this.myState.subfolder=i,this.myState.yamlConfig=s},async getVizDetails(){var n,r;if(this.config){this.vizDetails=Object.assign({},this.config);return}if((n=this.yamlConfig)!=null&&n.endsWith("yaml")||(r=this.yamlConfig)!=null&&r.endsWith("yml"))try{const o=this.yamlConfig.indexOf("/")>-1?this.yamlConfig:this.subfolder+"/"+this.yamlConfig,a=await this.fileApi.getFileText(o);this.vizDetails=ut.parse(a);return}catch(o){console.log("failed"+o);const a=o;this.fileSystem.needPassword&&a.status===401?I.commit("requestLogin",this.fileSystem.slug):this.$emit("error",""+o);return}const e=this.myState.yamlConfig.substring(0,15+this.myState.yamlConfig.indexOf("carriers")),{files:t}=await this.fileApi.getDirectory(this.myState.subfolder);let i=this.myState.yamlConfig.replaceAll("carriers","network");if(t.indexOf(i)==-1){const o=t.filter(a=>a.indexOf("network")>-1);o.length?i=o[0]:(this.myState.statusMessage="No road network found.",i="")}this.vizDetails={lsps:this.yamlConfig,network:i,carriers:"",title:e,description:"",center:this.vizDetails.center,projection:"",thumbnail:""};const s="Logistics Viewer";this.$emit("title",s)},async setMapCenter(){let e=0,t=0,i=0;if(this.vizDetails.center)typeof this.vizDetails.center=="string"&&(this.vizDetails.center=this.vizDetails.center.split(",").map(Number)),t=this.vizDetails.center[0],i=this.vizDetails.center[1];else if(!this.vizDetails.center){if(this.data=Object.entries(this.links),!this.data.length)return;const s=this.data.length/2,n=4096;for(let r=0;r<s;r+=n)t+=this.data[r*2][1][0],i+=this.data[r*2+1][1][1],e++;t=t/e,i=i/e}t&&i&&this.$store.commit("setMapCamera",{longitude:t,latitude:i,zoom:9,bearing:0,pitch:0,jump:!1})},handleClick(e){console.log("CLICK!",e),e||this.clickedEmptyMap(),(e==null?void 0:e.type)=="depot"&&this.clickedDepot(e),(e==null?void 0:e.type)=="leg"&&this.clickedLeg(e)},clickedDepot(e){const t=Object.values(e.vehicles).map(i=>i.$id);this.selectedTours=[],this.shownShipments=[];for(const i of this.lspChainToursAll)t.includes(i.vehicleId)&&(this.handleSelectTour(i),this.shipmentIdsInTour.forEach(s=>{this.shownShipments.push(this.shipmentLookup[s])}))},clickedLeg(e){e!=null&&e.tour&&this.handleSelectTour(e==null?void 0:e.tour)},clickedEmptyMap(){this.selectAllTours()},updateLegendColors(){},async loadLSPS(){const e=await this.loadFileOrGzippedFile(this.vizDetails.lsps);return e?(await K(e,{alwaysArray:["lsps.lsp","lsps.lsp.resources.carrier","lsps.lsp.resources.hub","lsps.lsp.shipments.shipment","lsps.lsp.LspPlans.LspPlan","lsps.lsp.LspPlans.LspPlan.logisticChains.logisticChain","lsps.lsp.LspPlans.LspPlan.logisticChains.logisticChain.logisticChainElement","lsps.lsp.LspPlans.LspPlan.shipmentPlans.shipmentPlan","lsps.lsp.LspPlans.LspPlan.shipmentPlans.shipmentPlan.element"]})).lsps.lsp.sort((s,n)=>M(s.$id,n.$id)):[]},async loadLinksCsv(){const e=await this.loadFileOrGzippedFile("output_links.csv.gz");return e&&[]},async loadCarriers(){const e=await this.loadFileOrGzippedFile("output_carriers.xml.gz");return e?(await K(e,{alwaysArray:["carriers.carrier","carriers.carrier.capabilities.vehicles.vehicle","carriers.carrier.plan.tour","carriers.carrier.shipments.shipment","carriers.carrier.services.service"]})).carriers.carrier.sort((s,n)=>M(s.$id,n.$id)):(console.log("can't find carriers"),[])},async loadNetwork(){if(this.myState.statusMessage="Loading network...",this.vizDetails.network.indexOf(".xml.")>-1){const e=`${this.myState.subfolder}/${this.vizDetails.network}`,t=await this.fetchNetwork(e,{});this.vizDetails.projection=""+t.projection,this.myState.statusMessage="Building network link table";const i={};return t.linkIds.forEach((s,n)=>{i[s]=[t.source[n*2],t.source[n*2+1],t.dest[n*2],t.dest[n*2+1]]}),i}else{const e=await this.fileApi.getFileJson(this.myState.subfolder+"/"+this.vizDetails.network);return this.vizDetails.projection="EPSG:4326",e}},async fetchNetwork(e,t){return new Promise((i,s)=>{const n=new St;try{n.postMessage({filePath:e,fileSystem:this.fileSystem,vizDetails:t}),n.onmessage=r=>{if(r.data.promptUserForCRS){let o=prompt("Enter the coordinate reference system, e.g. EPSG:25832")||"EPSG:31468";Number.isFinite(parseInt(o))&&(o=`EPSG:${o}`),n.postMessage({crs:o});return}if(r.data.status){this.myState.statusMessage=""+r.data.status;return}n.terminate(),r.data.error&&(console.error(r.data.error),I.commit("error",r.data.error),this.myState.statusMessage=r.data.error,s(r.data.error)),i(r.data.links)}}catch(r){n.terminate(),console.error(r),s(r)}})},toggleLoaded(e){this.isLoaded=e},rotateColors(){localStorage.setItem("plugin/agent-animation/colorscheme",this.globalState.isDarkMode?Z.DarkMode:Z.LightMode)},async loadFileOrGzippedFile(e){let t=`${this.subfolder}/${e}`;try{if(t.indexOf("*")>-1||t.indexOf("?")>-1){const n=t.substring(1+t.lastIndexOf("/")),r=t.substring(0,t.lastIndexOf("/")),{files:o}=await this.fileApi.getDirectory(r),a=vt(o,n);if(a.length==0)throw Error(`No files matched "${n}"`);if(a.length>1)throw Error(`More than one file matched "${n}": ${a}`);t=`${r}/${a[0]}`}let s="";if(t.endsWith("xml")||t.endsWith("gz")){const r=await(await this.fileApi.getFileBlob(t)).arrayBuffer(),o=bt(r);return new TextDecoder("utf-8").decode(o)}}catch{}const i=`Error loading ${t}`;return I.commit("error",i),this.myState.statusMessage=i,""},selectDropdown(){this.dropdownIsActive=!this.dropdownIsActive},selectPlan(e){for(let t=0;t<this.plans.length;t++)this.plans[t].$selected="false";e.$selected="true",this.selectedPlanIndex=this.plans.indexOf(e),this.selectedTours=[],this.selectDropdown(),this.selectedPlan=e}},async mounted(){I.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myState.subfolder=this.subfolder,this.yamlConfig||this.buildRouteFromUrl(),await this.getVizDetails(),!this.thumbnail&&(this.showHelp=!1,this.updateLegendColors(),this.myState.statusMessage="Loading carriers...",this.lsps=await this.loadLSPS(),this.carriers=await this.loadCarriers(),this.linksCsvData=await this.loadLinksCsv(),await this.$nextTick(),this.links=await this.loadNetwork(),this.setMapCenter(),this.myState.statusMessage="",this.lsps.length&&this.handleSelectLsp(this.lsps[0]),this.lspShipmentHubChains.length>0?this.activeTab="lspShipmentChains":this.activeTab="shipments",this.selectedCarrier=this.lsps[0].resources.carrier[0].$id,this.lspChainTours.length&&this.selectAllTours())},beforeDestroy(){this.myState.isRunning=!1,I.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}});var Pt=function(){var t=this,i=t._self._c;return t._self._setupProxy,i("div",{staticClass:"carrier-viewer",class:{"hide-thumbnail":!t.thumbnail},attrs:{oncontextmenu:"return false"}},[i("div",{staticClass:"container-1"},[i("div",{staticClass:"main-panel"},[t.thumbnail?t._e():i("tour-viz",{staticClass:"anim",attrs:{activeTab:t.activeTab,shipments:t.shownShipments,lspShipmentChains:t.lspShipmentChains,carrierTours:t.carrierTours,carrierServices:t.carrierServicesAll,showCompleteHubChain:t.showCompleteHubChain,depots:t.shownDepots,legs:t.shownLegs,showHub:t.showHub,hubLocation:t.hubLocation,hubName:t.hubName,stopActivities:t.stopActivities,dark:t.globalState.isDarkMode,center:t.vizDetails.center,viewId:t.linkLayerId,settings:t.vizSettings,numSelectedTours:t.selectedTours.length,onClick:t.handleClick,projection:t.vizDetails.projection}}),t.thumbnail?t._e():i("ZoomButtons"),t.myState.statusMessage?i("div",{staticClass:"xmessage"},[t._v(t._s(t.myState.statusMessage))]):t._e()],1),t.thumbnail?t._e():i("div",{staticClass:"right-panel",attrs:{darkMode:!0}},[t.lsps.length?i("h3",{staticStyle:{"margin-left":"0.25rem"}},[t._v(t._s("Service Providers"))]):t._e(),i("div",{staticClass:"lsp-list"},t._l(t.lsps,function(s){return i("div",{key:s.$id,staticClass:"lsp",class:{selected:s.$id===t.selectedLsp},on:{click:function(n){return t.handleSelectLspFromList(s)}}},[i("div",{staticClass:"lsp-title"},[t._v(t._s(s.$id))])])}),0),i("h4",[t._v(t._s(t.selectedLsp||"Details"))]),t.selectedLsp?i("b-field",{staticClass:"detail-buttons",attrs:{size:"is-small"}},[t.checkIfDirectChain()?i("b-radio-button",{attrs:{"native-value":"shipments",size:"is-small",type:"is-warning"},model:{value:t.activeTab,callback:function(s){t.activeTab=s},expression:"activeTab"}},[i("span",[t._v(t._s(t.$t("Shipment Chains")))])]):t._e(),t.checkIfHubChain()?i("b-radio-button",{attrs:{"native-value":"lspShipmentChains",size:"is-small",type:"is-warning"},model:{value:t.activeTab,callback:function(s){t.activeTab=s},expression:"activeTab"}},[i("span",[t._v(t._s(t.$t("Shipment Chains")))])]):t._e(),i("b-radio-button",{staticStyle:{},attrs:{"native-value":"lspTours",size:"is-small",type:"is-warning"},nativeOn:{click:function(s){return t.handleSelectLspButton(t.selectedLsp)}},model:{value:t.activeTab,callback:function(s){t.activeTab=s},expression:"activeTab"}},[i("span",[t._v(t._s(t.$t("LSP Tours")))])])],1):t._e(),i("br"),i("br"),i("br"),t.lsps.length?i("h3",{staticStyle:{"margin-left":"0.25rem"}},[t._v(t._s("Carriers"))]):t._e(),i("div",{staticClass:"carrier-list"},[i("h5",{staticStyle:{"font-weight":"bold"}},[t._v(t._s("Direct Chain Carriers:"))]),t._l(t.lspCarriers,function(s){return i("div",{key:s.$id,staticClass:"carrier",class:{selected:s.$id===t.selectedCarrier},on:{click:function(n){return t.handleSelectCarrier(s)}}},[i("div",{staticClass:"carrier-title"},[t._v(t._s(s.$id))])])}),i("br"),i("h5",{staticStyle:{"font-weight":"bold"}},[t._v(t._s("Hub Chain Carriers:")),t._l(t.allHubChains,function(s){return i("div",{key:s.chainIndex,staticClass:"carrierHub"},[i("h6",{staticStyle:{"font-weight":"bold"},attrs:{name:""},on:{click:function(n){return t.getCarrierServicesForHubChain(t.selectedLsp)}}},[t._v(t._s("Hub Chain "+s.chainIndex+":"))]),t._l(s.chainIds,function(n){return i("div",{key:n,staticClass:"carrier",class:{selected:n===t.selectedCarrier},on:{click:function(r){return t.handleSelectCarrier(n)}}},[i("div",{staticClass:"carrier-title"},[t._v(t._s(n))])])})],2)})],2)],2),i("h4",[t._v(t._s(t.selectedCarrier||"Details"))]),i("div",{staticClass:"switchbox"},[i("div",{staticClass:"switches"},[(t.activeTab=="lspTours"||t.activeTab=="tours")&&t.selectedCarrier!=""?i("b-switch",{model:{value:t.vizSettings.showEachCarrierTour,callback:function(s){t.$set(t.vizSettings,"showEachCarrierTour",s)},expression:"vizSettings.showEachCarrierTour"}},[i("span",{domProps:{innerHTML:t._s(t.$t("Carrier Tours"))}})]):t._e()],1)]),i("div",{staticClass:"detail-area"},[t.activeTab=="lspShipmentChains"?i("div",{staticClass:"lspShipmentChains"},[i("span",[t._v(t._s(t.$t("Lsp Shipments"))+": "+t._s(t.lspShipmentHubChains.length))]),t._l(t.lspShipmentHubChains,function(s,n){return i("div",{key:`${n}-${s.shipmentId}`,staticClass:"leaf tour",class:{selected:s==t.selectedLSPChain},on:{click:function(r){return t.handleSelectShipmentChain(s)}}},[t._v(t._s(`${s.shipmentId}: ${s.chainId}`))])})],2):t._e(),t.activeTab=="shipments"?i("div",{staticClass:"lspShipmentChains"},[i("span",[t._v(t._s(t.$t("Shipments"))+": "+t._s(t.shipments.length))]),t._l(t.shipments,function(s,n){return i("div",{key:`${n}-${s.$id}`,staticClass:"leaf tour",class:{selected:s==t.selectedShipment},on:{click:function(r){return t.handleSelectShipment(s)}}},[t._v(t._s(`${s.$id}`))])})],2):t._e(),t.activeTab=="lspTours"&&t.selectedCarrier&&t.hubLocation.length==0?i("div",{staticClass:"tours"},[i("span",[t._v(t._s(t.$t("tours"))+": "+t._s(t.carrierTours[0].length))]),t._l(t.carrierTours[0],function(s,n){return i("div",{key:`${n}-${s.$id}`,staticClass:"leaf tour",class:{selected:t.selectedTours.includes(s)},on:{click:function(r){return t.handleSelectTour(s)}}},[s.tourId?i("div",{staticClass:"carrier-tours"},[s.tourId&&t.vizSettings.showEachCarrierTour?i("div",{style:{backgroundColor:t.getTourColor(s.tourId,s.tourNumber)},attrs:{id:"tourColor"}}):t._e(),s.tourId&&!t.vizSettings.showEachCarrierTour?i("div",{style:{backgroundColor:t.getLspTourColor(s.vehicleId)},attrs:{id:"tourColor"}}):t._e(),s.tourId?i("div",{attrs:{id:"tour"}},[t._v(t._s(s.tourId)+": "+t._s(`${s.vehicleId}`))]):i("div",[t._v(t._s(`${s.vehicleId}`))])]):t._e()])})],2):t._e(),t.activeTab=="lspTours"&&!t.selectedCarrier?i("div",{staticClass:"lsptours"},[i("span",[t._v(t._s(t.$t("tours"))+": "+t._s(t.lspToursAll.length))]),t._l(t.lspToursAll,function(s,n){return i("div",{key:`${n}-${s.$id}`,staticClass:"leaf tour",class:{selected:t.selectedTours.includes(s)},on:{click:function(r){return t.handleSelectTour(s)}}},[s.tourId?i("div",{staticClass:"lsp-tours"},[s.tourId?i("div",{style:{backgroundColor:t.getLspTourColor(s.vehicleId)},attrs:{id:"tourColor"}}):t._e(),s.tourId?i("div",[t._v(t._s(s.tourId)+": "+t._s(`${s.vehicleId}`))]):i("div",[t._v(t._s(`${s.vehicleId}`))])]):t._e()])})],2):t._e()]),i("div",{staticClass:"switchbox"},[t.activeTab=="shipments"||t.activeTab=="lspShipmentChains"?i("div",{staticClass:"switches"},[i("p",[t._v(t._s(t.$t("scaleSize")))]),t.activeTab=="shipments"||t.activeTab=="lspShipmentChains"?i("b-slider",{staticClass:"slider",attrs:{tooltip:!1,type:"is-link",size:"is-small"},model:{value:t.vizSettings.scaleFactor,callback:function(s){t.$set(t.vizSettings,"scaleFactor",s)},expression:"vizSettings.scaleFactor"}}):t._e()],1):t._e(),t.activeTab=="tours"||t.activeTab=="lspTours"?i("div",{staticClass:"addedSpace"},[i("br")]):t._e(),t.activeTab=="tours"||t.activeTab=="lspTours"?i("div",{staticClass:"switches"},[i("b-switch",{model:{value:t.vizSettings.shipmentDotsOnTourMap,callback:function(s){t.$set(t.vizSettings,"shipmentDotsOnTourMap",s)},expression:"vizSettings.shipmentDotsOnTourMap"}},[i("span",{domProps:{innerHTML:t._s(t.$t("shipmentDots"))}})]),i("b-switch",{model:{value:t.vizSettings.simplifyTours,callback:function(s){t.$set(t.vizSettings,"simplifyTours",s)},expression:"vizSettings.simplifyTours"}},[i("span",{domProps:{innerHTML:t._s(t.$t("flatten"))}})])],1):t._e()])],1)])])},It=[];var xt=ct(Lt,Pt,It,!1,null,"c760c68f",null,null);const Jt=xt.exports;export{Jt as default};
//# sourceMappingURL=LogisticsViewer-2808d7b4.js.map
