import{d as f,g,U as u,B as h,h as c,n as p}from"./index-24c2379b.js";import{b as y}from"./ColorsAndWidths-1801eb2f.js";import{V as x}from"./VuePlotly-0e863d69.js";import{b as S}from"./LayoutManager-3185e870.js";import"./cubehelix-25f71112.js";import"./rainbow-3c4177eb.js";import"./threshold-576e5497.js";import"./index-f6506551.js";import"./HTTPFileSystem-017e7593.js";import"./index-719eff74.js";import"./TopSheet-21dca6a3.js";import"./papaparse.min-e0a05c20.js";import"./DashboardDataManager-9bea9fc4.js";import"./util-8430d78c.js";import"./fxp-b80b6d05.js";import"./RoadNetworkLoader.worker-ba4f3b4d.js";import"./Coords-23d23a7c.js";import"./group-f6e6d4c5.js";const b=f({name:"LineChartPanel",components:{VuePlotly:x},props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0},config:{type:Object,required:!0},cardTitle:{type:String,required:!0},cardId:String,datamanager:{type:Object,required:!0}},data:()=>({globalState:g.state,dataSet:{},id:"line-"+Math.floor(1e12*Math.random()),colorMap:{},YAMLrequirementsLine:{dataset:"",x:""},YAMLdeprecations:["usedCol"],layout:{height:300,margin:{t:8,b:0,l:0,r:0,pad:2},font:{color:"#444444",family:u},xaxis:{automargin:!0,autorange:!0,title:{text:"",standoff:12},animate:!0},yaxis:{automargin:!0,autorange:!0,title:{text:"",standoff:16},animate:!0,rangemode:"tozero"},legend:{orientation:"v",x:1,y:1}},data:[],options:{displaylogo:!1,responsive:!0,modeBarButtonsToRemove:["pan2d","zoom2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian","resetScale2d","toggleSpikelines","resetViewMapbox"],toImageButtonOptions:{format:"png",filename:"line-chart",width:null,height:null}}}),async mounted(){this.updateTheme(),this.options.toImageButtonOptions.filename=S(this.cardTitle,this.subfolder),this.dataSet=await this.loadData(),this.updateChart(),this.$emit("dimension-resizer",{id:this.cardId,resizer:this.changeDimensions}),this.$emit("isLoaded")},beforeDestroy(){var t;(t=this.datamanager)==null||t.removeFilterListener(this.config,this.handleFilterChanged)},watch:{"globalState.isDarkMode"(){this.updateTheme()}},methods:{changeDimensions(t){this.layout=Object.assign({},this.layout,t)},handleFilterChanged(){if(!this.datamanager)return;const{filteredRows:t}=this.datamanager.getFilteredDataset(this.config);if(!t||!t.length)this.dataSet={allRows:{}};else{const e={},i=Object.keys(t[0]);i.forEach(s=>e[s]={name:s,values:[]}),t.forEach(s=>{i.forEach(a=>e[a].values.push(s[a]))}),this.dataSet={allRows:e}}this.updateChart()},updateTheme(){const t={paper_bgcolor:h[this.globalState.colorScheme],plot_bgcolor:h[this.globalState.colorScheme],font:{color:this.globalState.isDarkMode?"#cccccc":"#444444"}};this.layout=Object.assign({},this.layout,t)},async loadData(){try{this.validateYAML();let t=await this.datamanager.getDataset(this.config);if(!this.config.filters)return t;this.datamanager.addFilterListener(this.config,this.handleFilterChanged);for(const[e,i]of Object.entries(this.config.filters)){const s={dataset:this.config.dataset,column:e,value:i,range:Array.isArray(i)};this.datamanager.setFilter(s)}return{allRows:{}}}catch(t){console.error(""+t)}return{allRows:{}}},validateYAML(){for(const t in this.YAMLrequirementsLine)t in this.config||this.$emit("error",{type:c.ERROR,msg:`line chart: missing required key: ${t}`,desc:JSON.stringify(this.config)});for(const t of this.YAMLdeprecations)this.config[t]&&this.$emit("error",{type:c.WARNING,msg:`line chart: deprecated field: ${t}`,desc:JSON.stringify(this.config)})},updateChart(){this.layout.xaxis.title.text=this.config.xAxisTitle||this.config.xAxisName||"",this.layout.yaxis.title.text=this.config.yAxisTitle||this.config.yAxisName||"";try{this.config.groupBy?this.updateChartWithGroupBy():this.updateChartSimple()}catch(t){const e=""+t;this.$emit("error",{type:c.ERROR,msg:e,desc:"Add a desription..."})}},updateChartWithGroupBy(){},updateChartSimple(){var d;let t=!1,e=this.config.columns||this.config.usedCol;this.config.legendName&&(this.config.legendTitles=this.config.legendName),(d=this.config.legendTitles)!=null&&d.length&&(t=!0);const i=this.dataSet.allRows||{},s=Object.keys(i);if(!s.length)return;if(!i[this.config.x]){this.$emit("error",`${this.cardTitle}: "${this.config.dataset}" x column "${this.config.x}" missing`);return}let a=i[this.config.x].values||[];this.config.skipFirstRow&&(a=a.slice(1)),!e&&s.length&&(e=s.filter(o=>o!==this.config.x).sort()),this.colorMap=y(e,this.config.colorRamp);const n=[];for(let o=0;o<e.length;o++){const l=e[o],m=t?this.config.legendTitles[o]??l:l;let r=i[l].values;this.config.skipFirstRow&&(r=r.slice(1)),this.config.convertToSeconds&&(r=this.convertToSeconds(r)),n.push({x:a,y:r,name:m,type:"line",textinfo:"label+percent",textposition:"inside",automargin:!1,marker:{color:this.colorMap[l]}})}this.data=n},convertToSeconds(t){t=t.map(e=>{try{return e.split(":").reduce((a,n)=>parseInt(n,10)+a*60,0)}catch{return 0}})}}});var _=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("VuePlotly",{staticClass:"myplot",attrs:{data:e.data,layout:e.layout,options:e.options,id:e.id}})},C=[];var v=p(b,_,C,!1,null,"beddf943",null,null);const E=v.exports;export{E as default};
//# sourceMappingURL=line-cb6494ac.js.map
